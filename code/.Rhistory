grid.arrange(gg1, gg2, gg3, nrow=1)
gg4
varcomp(m.best)
m.best
# new ssn with best parameters
m.best <- ssn_glm(
family="Gamma",
formula = Cent.97.5.ave ~ elevation,
ssn.object = DE_ssn,
tailup_type = "spherical",
taildown_type = "none",
euclid_type = "wave",
# tailup_type = "exponential",
# taildown_type = "spherical",
# euclid_type = "gaussian",
additive = "afvArea",
tailup_initial = tailup_initial("exponential", de=results.ave$w.ave.tu.de,
range=results.ave$w.ave.tu.range,
known="given"),
taildown_initial = taildown_initial("none", de=results.ave$w.ave.td.de,
range=results.ave$w.ave.td.range,
known="given"),
euclid_initial = euclid_initial("none", de=results.ave$w.ave.eu.de,
range=results.ave$w.ave.eu.range, known="given"),
nugget_initial = nugget_initial("nugget", nugget=results.ave$w.ave.n, known="given"),
estmethod = "reml")
plot(m.best)
varcomp(m.best)
m.best
# new ssn with best parameters
m.best <- ssn_glm(
family="Gamma",
formula = Cent.97.5.ave ~ elevation,
ssn.object = DE_ssn,
tailup_type = "spherical",
taildown_type = "none",
euclid_type = "wave",
# tailup_type = "exponential",
# taildown_type = "spherical",
# euclid_type = "gaussian",
additive = "afvArea",
tailup_initial = tailup_initial("spherical", de=results.ave$w.ave.tu.de,
range=results.ave$w.ave.tu.range,
known="given"),
taildown_initial = taildown_initial("none", de=results.ave$w.ave.td.de,
range=results.ave$w.ave.td.range,
known="given"),
euclid_initial = euclid_initial("wave", de=results.ave$w.ave.eu.de,
range=results.ave$w.ave.eu.range, known="given"),
nugget_initial = nugget_initial("nugget", nugget=results.ave$w.ave.n, known="given"),
estmethod = "reml")
plot(m.best)
# m1_predict = augment(m1, type.residuals = "response", drop=F)
m1.predict = augment(m.best, type.residuals = "response", drop=T)
DE_ssn$obs$fitted1 = m1.predict$.resid
DE_ssn$obs$prediction = m1.predict$.fitted
tg.mod1 <- Torgegram(
formula = fitted1 ~ 1,
ssn.object = DE_ssn,
cloud=T, cutoff=max(DE_ssn$obs$upDist)/2,
type = c("flowcon", "flowuncon", "euclid")
)
plot(tg.mod1)
plot(tg.mod1, "flowcon")
plot(tg.mod1, "flowuncon")
plot(tg.mod1, "euclid")
m.predict = augment(m.best, newdata="pred", interval="confidence")
m.predict$fitted = exp(m.predict$.fitted)
m.resid = augment(m.best, se.fit = T)
m.resid$resid = exp(m.resid$.resid)
m.resid$rid = DE_ssn$obs$rid
m.predict = merge(m.predict, m.resid[,c("rid", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
grid.arrange(gg1, gg2, gg3, nrow=1)
min.x.log = min(log(DE_ssn$obs$Cent.97.5.ave), DE_ssn$obs$prediction)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg2 = ggplot() +
geom_sf(data=edges.predict, aes(color=log(fitted))) +
geom_sf(data=DE_ssn$obs, aes(color=log(Cent.97.5.ave))) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(log(edges.predict$fitted)), max(log(edges.predict$fitted))),
oob=scales::squish,
name="log Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg3 = ggplot() +
geom_sf(data=edges.predict) +
geom_sf(data=m.predict %>% drop_na(resid), aes(color=resid)) +
scale_color_viridis_c(direction=-1) +
theme_bw() + labs(title="Uncertainty")
grid.arrange(gg1, gg2, gg3, nrow=1)
min.x.log = min(log(DE_ssn$obs$Cent.97.5.ave), DE_ssn$obs$prediction)
max.x.log = max(log(DE_ssn$obs$Cent.97.5.ave), DE_ssn$obs$prediction)
min.x = min(DE_ssn$obs$Cent.97.5.ave, exp(DE_ssn$obs$prediction))
max.x = max(DE_ssn$obs$Cent.97.5.ave, exp(DE_ssn$obs$prediction))
cv.predict = loocv(m.best, cv_predict=T)$cv_predict
cv.resid = exp(cv.predict) - DE_ssn$obs$Cent.97.5.ave
gg1 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=cv.predict, y=log(Cent.97.5.ave), size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x.log, max.x.log)) +
scale_x_continuous(limits=c(min.x.log, max.x.log)) +
scale_size(guide="none") +
theme_bw()
gg2 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=exp(cv.predict), y=Cent.97.5.ave, size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x, max.x)) +
scale_x_continuous(limits=c(min.x, max.x)) +
scale_size(guide="none") +
theme_bw() + theme(aspect.ratio=1)
grid.arrange(gg1, gg2, nrow=1, widths=c(1,1))
gg1 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=cv.predict, y=log(Cent.97.5.ave), size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x.log, max.x.log)) +
scale_x_continuous(limits=c(min.x.log, max.x.log)) +
scale_size(guide="none") + xlabs("LOOCV Log Prediction") + ylabs("Log Cent.97.5.ave")
gg1 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=cv.predict, y=log(Cent.97.5.ave), size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x.log, max.x.log)) +
scale_x_continuous(limits=c(min.x.log, max.x.log)) +
scale_size(guide="none") + xlabs("LOOCV Log Prediction") + ylabs("Log Cent.97.5.ave") +
theme_bw()
gg1 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=cv.predict, y=log(Cent.97.5.ave), size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x.log, max.x.log)) +
scale_x_continuous(limits=c(min.x.log, max.x.log)) +
scale_size(guide="none") + xlab("LOOCV Log Prediction") + ylab("Log Cent.97.5.ave") +
theme_bw()
gg2 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=exp(cv.predict), y=Cent.97.5.ave, size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x, max.x)) +
scale_x_continuous(limits=c(min.x, max.x)) +
scale_size(guide="none") + xlab("LOOCV Log Prediction") + ylab("Log Cent.97.5.ave") +
theme_bw() + theme(aspect.ratio=1)
grid.arrange(gg1, gg2, nrow=1, widths=c(1,1))
gg2 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=exp(cv.predict), y=Cent.97.5.ave, size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x, max.x)) +
scale_x_continuous(limits=c(min.x, max.x)) +
scale_size(guide="none") + xlab("LOOCV Prediction") + ylab("Cent.97.5.ave") +
theme_bw() + theme(aspect.ratio=1)
grid.arrange(gg1, gg2, nrow=1, widths=c(1,1))
gg1 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=cv.predict, y=log(Cent.97.5.ave), size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x.log, max.x.log)) +
scale_x_continuous(limits=c(min.x.log, max.x.log)) +
scale_size(guide="none") + xlab("LOOCV Log Prediction") + ylab("Log Cent.97.5 Ave 1949-1959") +
theme_bw()
gg2 = ggplot(data=DE_ssn$obs) +
geom_abline(slope=1) +
geom_point(aes(x=exp(cv.predict), y=Cent.97.5.ave, size=afvArea),
alpha=0.6) +
scale_y_continuous(limits=c(min.x, max.x)) +
scale_x_continuous(limits=c(min.x, max.x)) +
scale_size(guide="none") + xlab("LOOCV Prediction") + ylab("Cent.97.5 Ave 1949-1959") +
theme_bw() + theme(aspect.ratio=1)
grid.arrange(gg1, gg2, nrow=1, widths=c(1,1))
# coefficient of variation
loocv(m.best)$RMSPE / mean(DE_ssn$obs$Cent.97.5.ave) # LOOCV
RMSE(exp(DE_ssn$obs$prediction), DE_ssn$obs$Cent.97.5.ave) / mean(DE_ssn$obs$Cent.97.5.ave) # train
loocv(m.best)$RMSPE
# confidence intervals
confint(m.best)
m.predict.ci = augment(m.best, newdata="pred", interval="confidence")
m.predict.ci$fitted = exp(m.predict.ci$.fitted)
m.predict.ci$fitted.cl = exp(m.predict.ci$.lower)
m.predict.ci$fitted.cu = exp(m.predict.ci$.upper)
m.predict.ci$difference = m.predict.ci$fitted.cu - m.predict.ci$fitted.cl
edges.predict = merge(DE_ssn$edges, m.predict.ci[,c("rid", "fitted", "fitted.cl",
"fitted.cu", "difference")] %>% st_drop_geometry(),
by="rid", all.x=T)
c.min = min(m.predict.ci$fitted, m.predict.ci$fitted.cl, m.predict.ci$fitted.cu)
c.max = max(m.predict.ci$fitted, m.predict.ci$fitted.cl, m.predict.ci$fitted.cu)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(limits=c(min(m.predict.ci$fitted), max(m.predict.ci$fitted)),
option = "H", direction=-1, oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Predicted Cent.97.5.ave")
gg2 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted.cl)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(limits=c(min(m.predict.ci$fitted.cl), max(m.predict.ci$fitted.cl)),
option = "H", direction=-1, oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="95% Lower CI")
gg3 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted.cu)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(limits=c(min(m.predict.ci$fitted.cu), max(m.predict.ci$fitted.cu)),
option = "H", direction=-1, oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="95% Upper CI")
grid.arrange(gg1, gg2, gg3, nrow=1)
m.best
m.predict = augment(m.best, newdata="pred", interval="confidence")
m.predict$fitted = exp(m.predict$.fitted)
m.resid = augment(m.best, se.fit = T)
m.resid$resid = exp(m.resid$.resid)
m.resid$rid = DE_ssn$obs$rid
m.predict = merge(m.predict, m.resid[,c("rid", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg2 = ggplot() +
geom_sf(data=edges.predict, aes(color=log(fitted))) +
geom_sf(data=DE_ssn$obs, aes(color=log(Cent.97.5.ave))) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(log(edges.predict$fitted)), max(log(edges.predict$fitted))),
oob=scales::squish,
name="log Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg3 = ggplot() +
geom_sf(data=edges.predict) +
geom_sf(data=m.predict %>% drop_na(resid), aes(color=resid)) +
scale_color_viridis_c(direction=-1) +
theme_bw() + labs(title="Uncertainty")
grid.arrange(gg1, gg2, gg3, nrow=1)
m.best
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg3 = ggplot() +
geom_sf(data=edges.predict) +
geom_sf(data=m.predict %>% drop_na(resid), aes(color=resid)) +
scale_color_viridis_c(direction=-1) +
theme_bw() + labs(title="Residual")
grid.arrange(gg1, gg3, nrow=1)
m.predict$fitted
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
# geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
m.predict = augment(m.best, newdata="pred", interval="confidence")
m.predict$fitted = exp(m.predict$.fitted)
m.resid = augment(m.best, se.fit = T)
m.resid$resid = exp(m.resid$.resid)
m.resid$rid = DE_ssn$obs$rid
m.predict = merge(m.predict, m.resid[,c("rid", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
# geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
m.best
plot(m.best)
# m1_predict = augment(m1, type.residuals = "response", drop=F)
m1.predict = augment(m.best, type.residuals = "response", drop=T)
DE_ssn$obs$fitted1 = m1.predict$.resid
DE_ssn$obs$prediction = m1.predict$.fitted
tg.mod1 <- Torgegram(
formula = fitted1 ~ 1,
ssn.object = DE_ssn,
cloud=T, cutoff=max(DE_ssn$obs$upDist)/2,
type = c("flowcon", "flowuncon", "euclid")
)
plot(tg.mod1)
plot(tg.mod1, "flowcon")
plot(tg.mod1, "flowuncon")
plot(tg.mod1, "euclid")
tg.mod1 <- Torgegram(
formula = fitted1 ~ 1,
ssn.object = DE_ssn,
cloud=F, cutoff=max(DE_ssn$obs$upDist)/2,
type = c("flowcon", "flowuncon", "euclid")
)
plot(tg.mod1)
tg.mod1 <- Torgegram(
formula = fitted1 ~ 1,
ssn.object = DE_ssn,
cloud=F, cutoff=max(DE_ssn$obs$upDist)/2,
type = c("flowcon", "flowuncon", "euclid")
)
plot(tg.mod1)
m.best
m.predict = augment(m.best, newdata="pred", interval="confidence")
m.predict$fitted = exp(m.predict$.fitted)
m.resid = augment(m.best, se.fit = T)
m.resid$resid = exp(m.resid$.resid)
m.resid$rid = DE_ssn$obs$rid
m.predict = merge(m.predict, m.resid[,c("rid", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
# limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
# oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=log(fitted))) +
geom_sf(data=DE_ssn$obs, aes(color=log(Cent.97.5.ave))) +
scale_color_viridis_c(option = "H", direction=-1,
# limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
# oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
gg2 = ggplot() +
geom_sf(data=edges.predict, aes(color=log(fitted))) +
# geom_sf(data=DE_ssn$obs, aes(color=log(Cent.97.5.ave))) +
scale_color_viridis_c(option = "H", direction=-1,
# limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
# oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
grid.arrange(gg1, gg2, nrow=1)
# load ssn
DE_ssn <- ssn_import(paste0(path.root, "data/DE.ssn-v2.ssn"),
predpts="pred")
# join flood magnitude
DE.obs = DE_ssn$obs %>%
left_join(flow.df.seas, by="Site.ID")
DE.obs = DE.obs %>%
left_join(obs.elev[,c("Site.ID", "elevation")] %>% st_drop_geometry(), by="Site.ID")
DE_ssn$obs = DE.obs
DE_ssn$preds$pred = DE_ssn$preds$pred %>%
left_join(preds.elev[,c("rid", "pid", "elevation")] %>% st_drop_geometry(), by=c("rid", "pid"))
# new ssn with best parameters
m.best <- ssn_glm(
family="Gamma",
formula = Cent.97.5.ave ~ elevation,
ssn.object = DE_ssn,
tailup_type = "spherical",
taildown_type = "none",
euclid_type = "wave",
# tailup_type = "exponential",
# taildown_type = "spherical",
# euclid_type = "gaussian",
additive = "afvArea",
tailup_initial = tailup_initial("spherical", de=results.ave$w.ave.tu.de,
range=results.ave$w.ave.tu.range,
known="given"),
taildown_initial = taildown_initial("none", de=results.ave$w.ave.td.de,
range=results.ave$w.ave.td.range,
known="given"),
euclid_initial = euclid_initial("wave", de=results.ave$w.ave.eu.de,
range=results.ave$w.ave.eu.range, known="given"),
nugget_initial = nugget_initial("nugget", nugget=results.ave$w.ave.n, known="given"),
estmethod = "reml")
plot(m.best)
# m1_predict = augment(m1, type.residuals = "response", drop=F)
m1.predict = augment(m.best, type.residuals = "response", drop=T)
DE_ssn$obs$fitted1 = m1.predict$.resid
DE_ssn$obs$prediction = m1.predict$.fitted
tg.mod1 <- Torgegram(
formula = fitted1 ~ 1,
ssn.object = DE_ssn,
cloud=F, cutoff=max(DE_ssn$obs$upDist)/2,
type = c("flowcon", "flowuncon", "euclid")
)
plot(tg.mod1)
plot(tg.mod1, "flowcon")
plot(tg.mod1, "flowuncon")
plot(tg.mod1, "euclid")
m.predict = augment(m.best, newdata="pred", interval="confidence")
m.predict$fitted = exp(m.predict$.fitted)
m.resid = augment(m.best, se.fit = T)
m.resid$resid = exp(m.resid$.resid)
m.resid$rid = DE_ssn$obs$rid
m.predict = merge(m.predict, m.resid[,c("rid", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
m.resid$resid
m.resid
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
m.predict = augment(m.best, newdata="pred", interval="confidence")
m.predict$fitted = exp(m.predict$.fitted)
m.resid = augment(m.best, se.fit = T)
m.resid$resid = exp(m.resid$.resid)
m.resid$rid = DE_ssn$obs$rid
m.predict = merge(m.predict, m.resid[,c("rid", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=log(fitted))) +
geom_sf(data=DE_ssn$obs, aes(color=log(Cent.97.5.ave))) +
scale_color_viridis_c(option = "H", direction=-1,
# limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
# oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg2 = ggplot() +
geom_sf(data=edges.predict, aes(color=log(fitted))) +
# geom_sf(data=DE_ssn$obs, aes(color=log(Cent.97.5.ave))) +
scale_color_viridis_c(option = "H", direction=-1,
# limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
# oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
grid.arrange(gg1, gg2, nrow=1)
gg3
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
# limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
# oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
m.best
varcomp(m.best)
m.predict = augment(m.best, newdata="pred", interval="confidence")
m.predict$fitted
m.predict$fitted = exp(m.predict$.fitted)
m.predict$fitted
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted", "resid")] %>% st_drop_geometry(),
by="rid", all.x=T)
# add predictions to edges
edges.predict = merge(DE_ssn$edges, m.predict[,c("rid", "fitted")] %>% st_drop_geometry(),
by="rid", all.x=T)
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
# limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
# oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
gg1 = ggplot() +
geom_sf(data=edges.predict, aes(color=fitted)) +
geom_sf(data=DE_ssn$obs, aes(color=Cent.97.5.ave)) +
scale_color_viridis_c(option = "H", direction=-1,
limits=c(min(edges.predict$fitted), max(edges.predict$fitted)),
oob=scales::squish,
name="Cent.97.5.ave") +
theme_bw() + labs(title="Original and Predictions")
gg1
varcomp(m.best)
